% !TEX program = lualatex
% Para habilitar "magic comments" en Workshop Latex (VS Code): latex-workshop.latex.build.forceRecipeUsage: false

% ----------- Configuración del documento y márgenes -----------
\documentclass[a4paper,openany,oneside,12pt]{report}
\usepackage[left=3cm,right=2cm,top=2.5cm,bottom=2.5cm]{geometry}
\setcounter{secnumdepth}{4}

% ----------- Configuración de idioma y títulos en español -----------
\usepackage[spanish]{babel}
\renewcommand{\shorthandsspanish}{} 
\addto{\captionsspanish}{\def\chaptername{}}
\addto\captionsspanish{
  \renewcommand{\contentsname}{Índice de contenidos}
  \renewcommand{\listtablename}{Índice de tablas}
}

% ----------- Paquetes para estilos y tipografía -----------
\usepackage{fontspec}
\usepackage{fontsize}
\usepackage{setspace}
\usepackage{parskip}
\usepackage{xcolor}
\usepackage{colortbl}
\usepackage[hidelinks]{hyperref} % Para que los enlaces no se coloreen
%\usepackage{hyperref} % Para que los enlaces sí se coloreen
\usepackage{import}
\usepackage[natbibapa]{apacite}
\usepackage{fancyhdr}
\usepackage{titlesec}
\usepackage{graphicx}
\usepackage{float}
\usepackage{etoolbox}
\usepackage{tocloft}
\usepackage{comment}
\usepackage{makeidx}
\usepackage{caption}
\usepackage{relsize}
\usepackage{qrcode}
\usepackage[shortlabels]{enumitem}
\usepackage[textsize=tiny]{todonotes}% \usepackage[disable]{todonotes} % Para deshabilitar los todos

% ----------- Configuración de fuentes -----------
\setmainfont[Path=/usr/share/fonts/TTF/,
    BoldItalicFont=calibriz.ttf,
    BoldFont      =calibrib.ttf,
    ItalicFont    =calibrii.ttf,
    FontFace={l}{n}{Font=calibril.ttf},
    FontFace={l}{it}{Font=calibrili.ttf}
    ]{calibri.ttf}
\newcommand{\textlight}[1]{{\fontspec{calibril.ttf} #1}}
\newcommand{\textlightit}[1]{{\fontspec{calibrili.ttf} #1}}

% ----------- Configuración de colores y estilos -----------
\definecolor{azul_unir}{RGB}{0, 152, 205}
\setlength{\parskip}{6pt plus 1pt minus 1pt}
\setlength{\parindent}{0pt}
\onehalfspacing

% ----------- Configuración de cabeceras y pies de página -----------
\pagestyle{fancy}
\fancyhf{}
\fancyhead[R]{\textlight{\small \autor \\[-5pt] \titulo}}
\fancyfoot[R]{\thepage}
\bibliographystyle{apacite}

\fancypagestyle{plain}{
  \fancyhf{} 
  \fancyfoot[R]{\thepage}
  \fancyhead[R]{\textlight{\small \autor \\[-5pt] \titulo}}
  \renewcommand{\headrulewidth}{0.4pt} 
  \renewcommand{\footrulewidth}{0pt}  
}

\patchcmd{\chapter}{\thispagestyle{plain}}{\pagestyle{fancy}\thispagestyle{fancy}}{}{}

% ----------- Formateo de títulos y subsecciones -----------
\setstretch{1.5}

\titleformat{\chapter}[block]
{\fontsize{18pt}{25pt}\selectfont\color{azul_unir}\textlight}
{\thechapter.\ }
{1em}
{}
\titlespacing*{\chapter}{0pt}{0pt}{6pt}

\titleformat{\section}
{\fontsize{14pt}{21pt}\selectfont\color{azul_unir}\textlight}
{\thesection}
{1em}
{}
\titlespacing*{\section}{0pt}{6pt}{0pt}

\titleformat{\subsection}
{\fontsize{12pt}{12pt}\selectfont\bfseries}
{\thesubsection}
{1em}
{}
\titlespacing*{\subsection}{0pt}{0pt}{0pt}

\titleformat{\subsubsection}
{\fontsize{12pt}{12pt}\selectfont\normalfont}
{\thesubsubsection}
{1em}
{}
\titlespacing*{\subsubsection}{0pt}{0pt}{0pt}

% ----------- Formateo de índice -----------
\renewcommand{\cftchapfont}{\normalfont}        % para quitar la negrita al texto
\renewcommand{\cftchappagefont}{\normalfont}   % para quitar la negrita al número de página

% ----------- Comandos personalizados -----------
\newcommand{\titulo}{Creación sonora asistida por grandes modelos de lenguaje}
\newcommand{\autor}{Carlos Arturo Guerra Parra}
\AtBeginDocument{\renewcommand{\bibname}{Referencias bibliográficas}}
\newcommand{\defaultLaTeX}{\fontfamily{cmr}\selectfont \LaTeX \normalfont} % Para que LaTeX se vea bien en el texto

\captionsetup[figure]{
  font=it,
  labelfont=bf,
  labelsep=space,
  justification=justified,
  singlelinecheck=false
}
\newcommand{\source}[1]{\caption*{\begin{center}\smaller[1] Fuente: #1\end{center}}}

% ----------- Viudas y huérfanas -----------
\clubpenalty=20000	% para que no haya líneas viudas en el texto.
\widowpenalty=20000 % para que no haya huérfanas

% ----------- Contenido del documento -----------
\begin{document}

  \import{./portada/}{portada.tex}
  \setcounter{page}{2} % Para que tras la portada esté la página 2.

  \import{./capitulos/}{resumen.tex}
  \clearpage
  \tableofcontents
  \clearpage
  \listoffigures 
  \clearpage
  \listoftables
  \clearpage
  \import{./capitulos/}{introduccion.tex}
  \import{./capitulos/}{marco_teorico.tex}
  \import{./capitulos/}{estado_cuestion.tex}
  \import{./capitulos/}{metodologia.tex}
  \import{./capitulos/}{cuerpo.tex}
  \import{./capitulos/}{resultados.tex}
  \import{./capitulos/}{conclusiones.tex}
  \import{./capitulos/}{limitaciones_prospectiva.tex}
  \import{./capitulos/}{bibliografia.tex}
  \addcontentsline{toc}{chapter}{Índice de términos}
  \printindex % Índice de términos. Compilar con makeindex main
  % Ejemplo: LaTeX\index{LaTeX} es un sistema, mientras que BibTeX\index{LaTeX!BibTeX} es para bibliografía.
  \import{./anexos/}{anexos.tex}

\end{document}
